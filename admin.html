<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StoryHub Admin</title>
  <link rel="stylesheet" href="assets/css/admin.css">

  <!-- Firebase (Modular) Initialization -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDeiLybtGc6evATj5O7M1FiJd1GPYd-rYc",
      authDomain: "tamplatedoc.firebaseapp.com",
      databaseURL: "https://tamplatedoc-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "tamplatedoc",
      storageBucket: "tamplatedoc.appspot.com",
      messagingSenderId: "264966107720",
      appId: "1:264966107720:web:868abe93cdff209040de7d"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    window.firebaseApp = app;
    window.firebaseDatabase = database;
  </script>

  <!-- Firebase Storage Only for Admin -->
  <script type="module">
    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

    const storage = getStorage(window.firebaseApp);

    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('story-thumbnail');
      if (input) {
        input.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const fileRef = storageRef(storage, `thumbnails/${file.name}`);

          uploadBytes(fileRef, file).then(snapshot => {
            return getDownloadURL(snapshot.ref);
          }).then(url => {
            let hidden = document.getElementById('thumbnail-url');
            if (!hidden) {
              hidden = document.createElement('input');
              hidden.type = 'hidden';
              hidden.id = 'thumbnail-url';
              hidden.name = 'thumbnail-url';
              document.getElementById('story-form').appendChild(hidden);
            }
            hidden.value = url;
          });
        });
      }
    });
  </script>
</head>
<body>
  <!-- ... SIDEBAR DAN FORMULIR ... (salin dari kode Ahmad sebelumnya) ... -->
  <!-- Tambahkan ini di dalam #story-form -->
  <input type="hidden" id="thumbnail-url" name="thumbnail-url">
  <script src="assets/js/admin.js"></script>
</body>
</html>

